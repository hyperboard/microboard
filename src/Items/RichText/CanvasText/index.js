function K(t,n){n||(n=1/0);let e=[];for(let s of t)e.push(m(s,n));P(e);let o=0,i=0;for(let s of e)o=Math.max(o,s.width),i+=s.height;return E(e,n),{nodes:e,maxWidth:n,width:o,height:i,render:s=>{N(s,e)}}}var L={paragraph:m,heading:m,"block-quote":m,"bulleted-list":m,"numbered-list":m,"list-item":m,text:C};function m(t,n){var o;let e={type:t.type,lineHeight:(o=t.lineHeight)!=null?o:1.4,children:[],lines:[],align:t.horisontalAlignment};for(let i of t.children)e.children.push(L[i.type](i));return W(e,n),e}function C(t){let n=t.text.length===0?"\xA0":t.text;return{type:"text",text:n,style:T(t),blocks:[]}}function T(t){var o,i,s;let n={fontStyle:"normal",fontWeight:"normal",color:(o=t.fontColor)!=null?o:"black",backgroundColor:t.fontHighlight,fontSize:(i=t.fontSize)!=null?i:14,fontFamily:(s=t.fontFamily)!=null?s:"Arial"},e=t.styles?t.styles:[];for(let r of e)switch(r){case"bold":n.fontWeight="bold";break;case"italic":n.fontStyle="italic";break;case"underline":n.textDecorationLine="underline";break;case"strikethrough":n.textDecorationLine="line-through";break;case"superscript":n.verticalAlign="super";break;case"subscript":n.verticalAlign="sub";break}return n.font=A(n),n}var B=T({});function A(t){let n=t.fontStyle||"normal",e=t.fontWeight||400,o=t.fontSize||"14",i=t.fontFamily||"Arial";return`${n} ${e} ${o}px ${i}`}function W(t,n){let e=[];for(let o of t.children)F(e,o,n);t.lines=e,z(t),H(t,0,0)}function F(t,n,e){if(n.text===""){return}t.length===0&&(t.push([]),void 0);let o=n.style,i=n.text.split(`
`);for(let s of i){s=s.replaceAll("	","        ");let r=M(s);let l="",u=0,g=!1;for(;r.length>0;){u++;let c=r.shift(),f=l===""?c:l+""+c;let d=x(f,o);let a=t[t.length-1],w=0;for(let y of a)w+=y.width;if(w+d.width<=e)l=f;else if(l==="")if(a.length===0){let y=O(c,o,e),h=c.slice(y.length);let k=x(y,o);a.push(k),t.push([]),g=!0,r.unshift(h)}else t.push([]),g=!0,r.unshift(c);else{a.length===0&&g&&(l=l.trimStart());let y=x(l,o);a.push(y),t.push([]),g=!0,l="",r.unshift(c)}}if(l!==""){let c=x(l,o);t[t.length-1].push(c)}t.push([])}t[t.length-1].length===0&&t.pop()}function z(t){for(let n=0;n<t.lines.length;n++){let e=t.lines[n];if(e.length===0){let o=t.lines[n-1],i=B;o!==void 0&&(i=o[o.length-1].style),e.push(x(" ",i!=null?i:B,0,0))}}}function H(t,n,e){let o=t.lines,i=t.lineHeight,s=0,r=0,l=0,u=0,g=0;for(let c of o){let f=0,d,a=0,w=0,y=0;if(c.length!==0){for(let h of c)h.x=a,(h.fontSize>f||!d)&&(f=h.fontSize,d=h),a+=h.width;g+=f*i,a>u&&(u=a),l=r,r+=f*i,w=f*i-f,s=r-w/2-d.measure.descent;for(let h of c)h.y=s}}t.width=u,t.height=g}function x(t,n,e,o){let i=I(t,n);return{text:t,style:n,width:i.width,x:e,y:o,measure:i,fontSize:parseFloat(n.fontSize)}}var D=document.createElement("canvas"),S=D.getContext("2d"),b={};function R(t){return typeof t=="number"&&isFinite(t)}function p(t,n=0){return R(t)?t:n}function I(t,n){if(b[n.font]&&b[n.font][t])return b[n.font][t];S.font=n.font;let e=S.measureText(t),o=p(e.actualBoundingBoxAscent),i=p(e.actualBoundingBoxDescent),s=p(e.actualBoundingBoxLeft),r=p(e.actualBoundingBoxRight),l=p(e.fontBoundingBoxAscent),u=p(e.fontBoundingBoxDescent),g=p(e.width),c=Math.max(l,o),f=Math.max(u,i),d={actualBoundingBoxAscent:o,actualBoundingBoxDescent:i,actualBoundingBoxLeft:s,actualBoundingBoxRight:r,fontBoundingBoxAscent:l,fontBoundingBoxDescent:u,ascent:c,descent:f,width:Math.max(g,s+r),height:c+f};return b[n.font]||(b[n.font]={}),b[n.font][t]=d,d}function M(t){return t.split(/(\s+)/)}function O(t,n,e){let o=0,i=t.length,s="";for(;o<=i;){let r=Math.floor((o+i)/2);if(r===0){s=t.slice(0,1);break}let l=t.slice(0,r);x(l,n).width<=e?(s=l,o=r+1):i=r-1}return s}function P(t){let n=0;for(let e of t){for(let o of e.lines)for(let i of o)i.y+=n;n+=e.height}}function E(t,n){for(let e of t)switch(e.align){case"left":break;case"center":$(e,n);break;case"right":v(e,n);break}}function $(t,n){let e=t.width;for(let o of t.lines){let i=0;for(let r of o)i+=r.width;let s=(n-i)/2;for(let r of o)r.x+=s}}function v(t,n){let e=t.width;for(let o of t.lines){let i=0;for(let r of o)i+=r.width;let s=n-i;for(let r of o)r.x+=s}}function N(t,n){for(let e of n)U(t,e.lines)}function U(t,n){for(let e of n)for(let o of e)q(t,o)}function q(t,n){t.font=n.style.font,j(t,n),G(t,n),J(t,n)}function j(t,n){if(!n.style.backgroundColor)return;let e=n.measure;t.fillStyle=n.style.backgroundColor,t.fillRect(n.x,n.y-e.ascent,e.width,e.height)}function G(t,n){if(n.style.textDecorationLine!=="underline")return;let e=n.x,o=n.y,i=n.style,s=n.measure,r=s.width,l=s.height,u=i.color;t.strokeStyle=u,t.lineWidth=1,t.beginPath(),t.moveTo(e,o+2),t.lineTo(e+r,o+2),t.stroke(),t.strokeStyle=i.backgroundColor,t.lineWidth=2}function J(t,n){let{text:e,style:o,x:i,y:s,measure:r}=n;t.fillStyle=o.color,t.fillText(e,i,s)}export{K as getBlockNodes};
